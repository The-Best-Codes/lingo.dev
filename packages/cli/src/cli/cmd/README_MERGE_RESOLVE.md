# Merge Resolve Command

## Overview

The `lingo.dev merge-resolve` command automatically resolves merge conflicts in `meta.json` and `dictionary.js` files generated by lingo.dev. This command is designed to handle the most common merge conflict scenarios that occur when multiple developers are working on internationalization simultaneously.

## Usage

```bash
# Basic usage - auto-resolve all lingo.dev merge conflicts
lingo.dev merge-resolve

# Dry run to see what would be resolved
lingo.dev merge-resolve --dry-run

# Resolve with verbose output
lingo.dev merge-resolve --verbose

# Create backups before resolving
lingo.dev merge-resolve --backup

# Use specific resolution strategy
lingo.dev merge-resolve --strategy ours

# Resolve specific files only
lingo.dev merge-resolve --files "**/lingo/meta.json"
```

## Options

- `--dry-run`: Show what would be resolved without making changes
- `--files <pattern>`: Specific file pattern to resolve (default: auto-detect)
- `--strategy <strategy>`: Resolution strategy (smart|ours|theirs) (default: smart)
- `--verbose`: Show detailed resolution steps
- `--backup`: Create backup files before resolving

## Resolution Strategies

### Smart Strategy (Default)

The smart strategy uses intelligent merging rules specific to lingo.dev file formats:

#### For meta.json:

- **Scope Merging**: Combines all unique scopes from both sides
- **Conflict Resolution**: For existing scopes, prefers the version with:
  - Different hash (indicating content changes)
  - Longer/more detailed content
  - More recent modifications

#### For dictionary.js:

- **Entry Merging**: Combines all unique translation entries
- **Translation Merging**: For conflicting translations:
  - Merges all locale translations
  - Prefers non-empty translations over empty ones
  - Maintains translation completeness across all locales

### Ours Strategy

Always chooses the "ours" side of the conflict (current branch).

### Theirs Strategy

Always chooses the "theirs" side of the conflict (incoming branch).

## Common Scenarios

### Scenario 1: Parallel Feature Development

```
Branch A: Adds new component translations
Branch B: Adds different component translations
Result: Both sets of translations are preserved
```

### Scenario 2: Content Updates

```
Branch A: Updates existing translation content
Branch B: Updates same translation differently
Result: Prefers the more detailed/longer content
```

### Scenario 3: New Locales

```
Branch A: Adds French translations
Branch B: Adds Spanish translations
Result: Both locale sets are merged together
```

## File Structure

The command processes these file types:

- `**/lingo/meta.json` - Metadata about translatable content
- `**/lingo/dictionary.js` - Translation dictionaries
- `**/lingo/dictionary.ts` - TypeScript translation dictionaries

## Error Handling

The command handles various error conditions:

- Invalid JSON/JavaScript syntax in conflict sections
- Missing required fields after resolution
- File permission issues
- Malformed git conflict markers

## Examples

### Example 1: Basic Resolution

```bash
$ lingo.dev merge-resolve
✓ Found 2 conflicted file(s)
  ✓ Resolved meta.json (1 conflicts)
  ✓ Resolved dictionary.js (1 conflicts)
✓ Successfully resolved 2 file(s)
```

### Example 2: Dry Run

```bash
$ lingo.dev merge-resolve --dry-run --verbose
✓ Found 1 conflicted file(s)
  ✓ Would resolve meta.json (1 conflicts)
    Resolved 1 conflict(s) in meta.json using smart strategy
ℹ Dry run complete: 1 files would be resolved, 0 failed
```

### Example 3: With Backup

```bash
$ lingo.dev merge-resolve --backup
✓ Found 1 conflicted file(s)
  ✓ Resolved meta.json (1 conflicts)
✓ Successfully resolved 1 file(s)
# Creates: meta.json.backup.1703123456789
```

## Integration with Git Workflow

This command integrates well with standard Git workflows:

```bash
# During a merge with conflicts
git merge feature-branch
# Auto-merge conflict detected

# Resolve lingo.dev conflicts automatically
lingo.dev merge-resolve

# Continue with the merge
git add .
git commit
```

## Limitations

- Only handles conflicts in lingo.dev generated files
- Requires valid JSON/JavaScript syntax in conflict sections
- Cannot resolve semantic conflicts (requires human review)
- Does not handle conflicts in other file types

## Troubleshooting

### Invalid Syntax Errors

If the command reports syntax errors, manually review the conflict markers to ensure they're properly formatted.

### Resolution Failures

Use `--verbose` flag to see detailed information about why resolution failed.

### Backup Recovery

If resolution produces unexpected results, restore from backup files:

```bash
cp meta.json.backup.1703123456789 meta.json
```
